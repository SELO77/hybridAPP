<!doctype html>
<html class="no-js" lang="en">
<head>

<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<!-- -->
<title>DodamDodam</title>
<meta name="description" content="">
<meta name="viewport"
	content="width=device-width, initial-scale=1 minimum-scale=1, maximum-scale=1, user-scalable=no">
<!-- 모바일 친화적 뷰 설정 -->

<link rel="apple-touch-icon" href="apple-touch-icon.png">
<!-- Place favicon.ico in the root directory -->
<link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css">
<link rel="stylesheet" href="css/__main.css">
<link rel="stylesheet" href="css/slidebars.css">
<!-- [SELO77] css -->
<style>
#defaultImg {
	border-width: thin;
	border-style: solid;
	width: 100px;
}

.form-group span {
	font-size: 14px;
}
</style>
</head>
<body style="padding-bottom: 110px;">
	<!--[if lt IE 8]>
						<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
						<![endif]-->

	<div style="padding: 0px 40px;">
		<form role="form">

			<div class="form-group" align="center">
				<input type="file" id="bPhoto" name="bPhoto" style="display: none">
				<div id="uploadImage" onclick=$("#bPhoto").click()></div>

				<img id="defaultImg" src="img/baby/defaultImagae.png"
					class="img-rounded" onclick=$("#bPhoto").click()>
			</div>

			<div class="form-group">
				<span><icon class="fa fa-user"></icon>&nbsp;아가 이름</span> <input
					type="text" class="form-control" name="bName" id="bName"
					placeholder="뱃속에 아기는 태명으로~">
				<div id="nameCheck" style="color: #ff0000"></div>
			</div>

			<div class="form-group">
				<span><icon class="fa fa-user"></icon>&nbsp;언제 태어났어요?</span> <input
					type="text" class="form-control" name="bBirth" id="bBirth"
					placeholder="예) 2016-01-18" onkeydown="onlyNumber(event)">
			</div>
			<div class="form-group">
				<span><icon class="fa fa-arrows-v"></icon>&nbsp;키</span> <input
					type="text" class="form-control" name="height" id="height"
					placeholder="무럭 무럭 클거에요~" onkeydown="onlyNumber(event)">
			</div>
			<div class="form-group">
				<span><icon class="fa fa-arrows-h"></icon>&nbsp;몸무게</span> <input
					type="text" class="form-control" name="weight" id="weight"
					placeholder="몸무게" onkeydown="onlyNumber(event)">
			</div>
			<div class="form-group" align="center">

				<label class="radio-inline"> <input type="radio" name="bSex"
					id="male" value="1" selected><span class="fa fa-mars">&nbsp;남</span>
				</label> <label class="radio-inline"> <input type="radio"
					name="bSex" id="female" value="2"><span class="fa fa-venus">&nbsp;여</span>
				</label>
			</div>
			<div class="form-group" align="center">

				<label class="radio-inline"> <input type="radio"
					name="bType" id="AType" value="A">A형
				</label> <label class="radio-inline"> <input type="radio"
					name="bType" id="BType" value="B">B형
				</label> <label class="radio-inline"> <input type="radio"
					name="bType" id="OType" value="O">O형
				</label> <label class="radio-inline"> <input type="radio"
					name="bType" id="ABType" value="AB">AB형
				</label>
			</div>

			<button type="button" class="btn btn-primary btn-lg btn-block ; fa  "
				id="btn01" style="">등록하기</button>

		</form>
	</div>

	<!-- 메인 html끝 [진영]-->

	<script src="js/vendor/jquery-1.11.3.min.js"></script>





	<!-- script plug in start -->
	<script src="js/vendor/modernizr-2.8.3.min.js"></script>

	<!-- [근한] 파일업로드를 위한 js파일 추가 -->
	<script src="js/vendor/jquery.ui.widget.js"></script>
	<script src="js/jquery.fileupload.js"></script>
	<!-- /[근한] 파일업로드를 위한 js파일 추가 끝 -->

	<!-- ip 등 meta data 가져오기 -->
	<script src="js/jihoon/getMetaData.js"></script>


	<script>


							var user=getMetaData('user');
							var responseURL="mainIndex.html";

							document.addEventListener("backbutton", onBackKeyDown, false);
							function onBackKeyDown(){
							 //window.plugins.toast.show('Really Exit?'.'short'.'center',)
							 testLogoutSheet();
							}

						//Action sheet

						function testLogoutSheet() {
							var options = {
								'androidTheme' : window.plugins.actionsheet.ANDROID_THEMES.THEME_HOLO_LIGHT,
								'title': 'Are you sure to close it?',
								'buttonLabels': ['No','Yes'],
								'androidEnableCancelButton' : true,
								'winphoneEnableCancelButton' : true,
									//'addCancelButtonWithLabel': 'Cancel'
								};
								window.plugins.actionsheet.show(options, callback);
							}

							var callback = function(buttonIndex) {
								setTimeout(function() {
									if (buttonIndex == 2) {
										navigator.app.exitApp();
									};
								});
							};


							//[근한] focus event를 위한 jQuery 추가
							$("#bName").focusout(function(){

								$("#bName").attr({
									placeholder: '태명,별명도 입력가능'
								});
							});


							$("#bBirth").focusout(function(){
								$("#bBirth").attr({
									placeholder: 'ex(2015-12-07)'
								});
							});

							$("#height").focusout(function(){
								$("#height").attr({
									placeholder: '키             (cm)'
								});
							});

							$("#weight").focusout(function(){
								$("#weight").attr({
									placeholder: '체중          (kg)'
								});
							});

							$('input').focus(function() {

								$(this).attr('placeholder', '');								
							});

							$("#bName").focusin(function(){
								$("#nameCheck").empty();
							});
							//[근한] focus event를 위한 jQuery 추가 끝

							

							//[근한] 이름 null check를 위한 jQuery 추가
							$("#btn01").on("click",function() {
								
								if($("#bName").val()!=null && $("#bName").val()!=""){

									add_baby_test();
								}
								else{
									$("#bName").attr({
										placeholder: '태명,별명도 입력가능'
									});

									$("#nameCheck").append("이름을 입력하고 등록해주세요.");
									$("#nameCheck").css("color","red");
								}
							}); 
							//[근한] 이름 null check를 위한 jQuery 추가 끝




							//[시용,근한] fileupload를 위한 javascript 추가
							var uploadFormData;
							function add_baby_test(){
								var formData = {
									bName:$("input[name='bName']").val(),
									bBirth:$("input[name='bBirth']").val(),
									bSex:$("input[name='bSex']").val(),
									bType:$("input[name='bType']").val(),
									height:$("input[name='height']").val(),
									weight:$("input[name='weight']").val(),
									bPhoto:babyImage,
									uNo:100001
								}

								uploadFormData = formData;

								$.ajax(
								{
									url:getMetaData('ip')+"baby/json/addBaby",
									method:"POST",
									dataType:"application/json",
									data:JSON.stringify(formData),
									contentType:"application/json",
									success:function(result){
										alert(JSON.stringify(formData)+" success");
										console.log(result);
										self.location=responseURL;

									},
									error:function(){
										alert(JSON.stringify(formData));
									}

								});
							}


							$(function(){
								$("#bPhoto").change(function () {
									if (typeof (FileReader) != "undefined") {
										var dvPreview = $("#uploadImage");
										dvPreview.html("");
										var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.jpg|.jpeg|.gif|.png|.bmp)$/;
										$($(this)[0].files).each(function () {
											var file = $(this);
											if (regex.test(file[0].name.toLowerCase())) {
												var reader = new FileReader();
												reader.onload = function (e) {
													var img = $("<img />");
													img.attr("name",file[0].name);
													img.attr("id","multi");
													img.attr("style", "width:100px; height:100px; margin-right: 10px;margin-top: 10px;");
													img.attr("src", e.target.result);
													img.attr("class","img-rounded");

													dvPreview.append(img);

													$("#defaultImg").attr("style","display:none");	



												}
												reader.readAsDataURL(file[0]);
											} else {
												alert(file[0].name + " : 이미지 형식이 잘못됬습니다.");
												dvPreview.html("");
												return false;
											}
										});
									} else {
										alert("상위 버전 브라우저를 이용해주세요.");
									}
								});
}); 


$("#btn01").on("click" , function() {
	fncAddJsonDodam();
	/* fncFileUploadTrace(); */
});										

var babyImage="";
function  fncAddJsonDodam(){

	var imageLength = $("div#uploadImage > img").length;											
	for(var i=0 ; i<imageLength; i++){
		if(i == (imageLength - 1)){
			babyImage +=$("div#uploadImage > img:eq("+i+")").attr('name');
		}else{
			babyImage += $("div#uploadImage > img:eq("+i+")").attr('name') +",";
		}
	} 
	console.log("==babyImage :"+babyImage);											  
	$.ajax({
		type:"POST",
		async:false,
		headers : {
			"Accept" : "application/json",
			"Content-Type" : "application/json"
		},
		data: JSON.stringify({
			bPhoto : babyImage,
			text : {
				uploadFormData
			},
		}),
		url:getMetaData('ip')+"baby/json/addBaby",
		dataType:"json",
		success:function(data, status){
			console.log('==response status :'+status);
		}
												  });// /ajax
												}// end of fnc



												

												$('#bPhoto').fileupload({
													dataType: 'json',
													url:getMetaData('ip')+'baby/json/uploadImg',
													add: function (e, data) {
														$("#btn01").click(function () {
															data.submit();
														});
													}
											});										
										

											//[근한] 숫자만 입력받게 onkeyDown 이벤트 추가 
											function onlyNumber(event){
												var kc=event.keyCode;
												if((kc<48 || kc>57) && (kc<96 || kc>105) && kc!=32 && kc!=8 && kc!=9 && kc!=46 && kc!=35 && kc!=189 && kc!=110 && kc!=106 && kc!=110 && kc!=190 ){
													$("#bBirth").blur();
													$("#height").blur();
													$("#weight").blur();								
												} 
											}
											//[근한] 숫자만 입력받게 onkeyDown 이벤트 추가 끝



										</script>

	</div>
</body>
</html>
