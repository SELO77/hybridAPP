<!doctype html>
<html class="no-js" lang="">
<head>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<!-- -->
	<title>UserInfo</title>
	<meta name="description" content="">
	<meta name="viewport"
	content="width=device-width, initial-scale=1 minimum-scale=1, maximum-scale=1, user-scalable=no">
	<!-- 모바일 친화적 뷰 설정 -->

	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css">
	<link rel="stylesheet" href="css/__main.css">

<!-- 현업에 혼자 코딩하는 사람 없습니다....... 가독성 생각해서 작성해주세요.
		아래 형식들 정리해 놓았으니 HTML 코드 부분 Script 코드 부분 확인하고 작성해주세요.
		마지막으로 코드 정렬 하면서 작성해주세요. 예) 탭질 잘할것. -->
		<!-- 아래 부분은 CSS 추가 부분 입니다.-->
		<!-- -[작성자] 추가 CSS 설명 -->
		<style>
			

			.container{
				padding: 0 25px 0 25px;
			}

			label{
				margin-bottom: 0px
			}

			.form-group {
   				margin-bottom: 5px; 
			}
			

				

		</style>

	</head>
	<body style="padding-bottom: 60px; padding-top: 60px" onload="getUser();">
	<!--[if lt IE 8]>
					<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
					<![endif]-->

					<!-- HTML 코드 작성 부분 입니다 -->
					<!-- [작성자] 컨텐츠 내용 -->
					<div class="container">
						<div class="row">
							<!-- left column -->
							<div>&nbsp;</div>
							<div class="col-md-3">
								<div class="text-center">
									<img src="img/siba.jpg" class="avatar img-round" alt="avatar" style="width:200px;height:200" onclick=$("#uPhoto").click();>	
									<div>&nbsp;</div>
									<input type="file" class="form-control" style="display:none" id="uPhoto">

								</div>
							</div>

							<!-- edit form column -->
							<div class="col-md-9 personal-info">
								<div class="alert alert-info alert-dismissable" id="popup">
									<a class="panel-close close" data-dismiss="alert">×</a> 
									<i class="fa fa-coffee"></i>
									사진을 등록하고 더 많은 유저와 소통하세요.
								</div>


								<form class="form-horizontal" role="form">
									<div class="form-group">
										<label class="col-lg-3 control-label "><span class="fa fa-envelope"></span>&nbsp;이메일</label>
										<div class="col-lg-8">
											<input class="form-control" type="text" value="Jane" id="email">
										</div>
									</div>
									
									<div class="form-group">
										<label class="col-lg-3 control-label"><span class="fa fa-smile-o"></span>&nbsp;별명</label>
										<div class="col-lg-8">
											<input class="form-control" type="text" value="" id="nickname">
										</div>
									</div>

									<div class="form-group">
										<label class="col-lg-3 control-label"><span class="fa fa-unlock"></span>&nbsp;현재 비밀번호</label>
										<div class="col-lg-8">
											<input class="form-control" type="password" value="" 
											id="currentPassword">
										</div>
										<div id="currentPasswordCheck"></div>
									</div>
									<div class="form-group">
										<label class="col-lg-3 control-label"><span class="fa fa-lock"></span>&nbsp;비밀번호 변경</label>
										<div class="col-lg-8">
											<input class="form-control" type="password" value="" 
											id="changePassword">
										</div>
									</div>

									<div class="form-group">
										<label class="col-lg-3 control-label"><span class="fa fa-lock"></span>&nbsp;비밀번호 확인</label>
										<div class="col-lg-8">
											<input class="form-control" type="password" value=""
											id="checkPassword">
										</div>
										<div id="changePasswordCheck"></div>
									</div>

									<div class="form-group">
										<label class="col-md-3 control-label"></label>
										<div class="col-md-8">
											<input type="button" class="btn btn-primary" id="submit" 
											value="확 인" style="width:70px">

											<input type="reset" class="btn btn-default" value="취 소" style="width:70px;position:absolute;right:5%">
										</div>
									</div>
								</form>
							</div>
						</div>
					</div>
					<hr>






					<script src="js/vendor/jquery-1.11.3.min.js"></script>
					<script src="cordova.js"></script>
					<!-- script plug in start -->
					<script src="js/vendor/modernizr-2.8.3.min.js"></script>
					<!-- bootStrap.js CDN -->
					<script src="js/bootstrap/bootstrap.min.js"></script>

					<script src="js/vendor/jquery.ui.widget.js"></script>
					<!-- ip 등 meta data 가져오기 -->
					<script src="js/jihoon/getMetaData.js"></script>
					<script src="js/vendor/jquery.ui.widget.js"></script>
					<script src="js/jquery.fileupload.js"></script>

					<!--  아래는 스크립트 라이브러리 추가 및 스크립트 작성 영역입니다.-->
					<!-- [작성자] 추가 라이브러리 요약 -->
					<!-- 라이브러리 추가는 아래 형식으로 하시오 -->
	<!-- 스크립트 작성 부분 끝입니다. -->

	<script>

		var user=getMetaData("user");


		document.addEventListener("backbutton", onBackKeyDown, false);
		function onBackKeyDown() {
			//window.plugins.toast.show('Really Exit?'.'short'.'center',)
			testLogoutSheet();
		}
		//Action sheet
		function testLogoutSheet() {
			var options = {
				'androidTheme' : window.plugins.actionsheet.ANDROID_THEMES.THEME_HOLO_LIGHT,
				'title' : 'Are you sure to close it?',
				'buttonLabels' : [ 'No', 'Yes' ],
				'androidEnableCancelButton' : true,
				'winphoneEnableCancelButton' : true,
			//'addCancelButtonWithLabel': 'Cancel'
		};
		window.plugins.actionsheet.show(options, callback);
	}

	var callback = function(buttonIndex) {
		setTimeout(function() {
				//alert('button index clicked: ' + buttonIndex);
				if (buttonIndex == 2) {
					navigator.app.exitApp();
				}
				;
			});
	};


	function getUser(){

		alert("getUser::");

			$.ajax({
				url:getMetaData("ip")+"user/json/getUser",
				method:"POST",
				contentType:"application/json",
				dataType:"json",
				data:JSON.stringify({uNo:user.uNo}),
				success:function(result){
					console.log(result);

					$("#email").val(result.user.mail);
					$("#nickname").val(result.user.nickname);

					$("#currentPassword").focusout(function() {
						if($("#currentPassword").val()!=result.user.password) {
							$("#currentPasswordCheck").css("color","red");
							if($("#currentPasswordCheck").children().length==0){
							$("#currentPasswordCheck")
							.append("<text id='alertPassword'>&nbsp&nbsp&nbsp비밀번호가 일치하지 않습니다.</text>");
							}
						}
						else{
							$("#alertPassword").remove();
						}
					});

					$("#submit").on("click",function(){
						if($("#changePassword").val()!=$("#checkPassword").val()) {
							console.log($("#changePassword").val()+"::"+$("#checkPassword").val());
							$("#changePasswordCheck").css("color","red");
							if($("#changePasswordCheck").children().length==0){
							$("#changePasswordCheck")
							.append("<text id=alertChangePassword>&nbsp&nbsp&nbsp변경한 비밀번호와 일치하지 않습니다.</text>");
							}
						}
						else{
							$("#alertChangePassword").remove();

							$.ajax({
							url:getMetaData("ip")+"user/json/updateUser",
							method:"POST",
							dataType:"json",
							contentType:"application/json",
							data:JSON.stringify({
								uNo:user.uNo,
								mail:$("#email").val(),
								nickname:$("#nickname").val(),
								password:$("#changePassword").val(),
								uPic:user.uPic,
								uBirth:user.uBirth
							}),
							success:function(result){
								alert("success:: "+result.result);
								$(window.parent.frames["innerframe"].document.location)
				           		.attr("href","mainIndex.html");
								}
							});
						}
					});

				}
			});
	}


</script>
</body>
</html>
