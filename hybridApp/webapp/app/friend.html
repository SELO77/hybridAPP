<!doctype html>
<html class="no-js" lang="">
<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<!-- -->
<title>DodamDodam</title>
<meta name="description" content="">
<meta name="viewport"
	content="width=device-width, initial-scale=1 minimum-scale=1, maximum-scale=1, user-scalable=no">
<!-- 모바일 친화적 뷰 설정 -->

<meta name="description" content="">
<meta name="author" content="">
<link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css">
<link rel="stylesheet" href="css/__main.css">
<link rel="stylesheet" href="css/bootstrap.css">
<!-- 현업에 혼자 코딩하는 사람 없습니다....... 가독성 생각해서 작성해주세요.
		아래 형식들 정리해 놓았으니 HTML 코드 부분 Script 코드 부분 확인하고 작성해주세요.
		마지막으로 코드 정렬 하면서 작성해주세요. 예) 탭질 잘할것. -->
<!-- 아래 부분은 CSS 추가 부분 입니다.-->
<!-- -[지훈] friend List항목 2EA -->
<link rel="import" href="import/friendReqList.html">
<link rel="import" href="import/friendList.html">

<!-- [지훈] style 설정  -->
<style type="text/css">
	.modal-backdrop{
		z-index: -1;
	}
	img{
		box-shadow: 3px 3px 10px rgba(0, 0, 0, .8);
	}

</style>


</head>
<body style="padding-top: 60px;">
	<!--[if lt IE 8]>
					<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
			<![endif]-->

	<!-- HTML 코드 작성 부분 입니다 -->
	<!-- [지훈] 친구 관리 화면 Start -->
	<div class="container" style="padding-bottom: 30px; padding-left: 0px; padding-right: 0px;">
		<div id="friend_req_list">
			<li class="list-group-item">친구 요청 <span class="badge"
				id="req_count">+</span>
			</li>
		</div>

		<div id="friend_list">
			&nbsp;
			<!-- &nbsp; 지우면  <li class="list-group-item"> 상하 크기 커짐! 지우지말것! -->
			<li class="list-group-item">내 친구 목록<span class="badge"
				id="fr_count">+</span>
			</li>
		</div>

		<div data-toggle="modal" data-target="#fr_option_modal">
			<img src="img/add_friend.jpg" id="fr_option" style="border-radius: 50px;
																position: fixed; bottom: 30px; right: 2%; height: 50px; width: 50px;">
			</img>
		</div>

	</div>

	<!-- Modal -->
	<div class="modal fade" id="fr_option_modal" role="dialog">
		<div class="modal-dialog" style="position: fixed; bottom: 90px; right: 2%;">

			<!-- Modal content-->
			<div id="searchFriend">
				<img src="img/search-friend.jpg" style="border-radius: 40px; height: 40px; width: 40px; 
														position: relative; left: -50px; bottom: -35px;">
				</img>
				<div class="modal-content" style="margin-bottom: 5px;">
					<div class="modal-body" style="padding: 0px;">
						<span><big>&nbsp;친구 검색&nbsp;</big></span>
					</div>
				</div>
			</div>


			<div id="denyList">
				<img src="img/deny-friend.jpg" style="border-radius: 40px; height: 40px; width: 40px; 
														position: relative; left: -50px; bottom: -33px;">
				</img>
				<div class="modal-content">
					<div class="modal-body" style="padding: 0px;">
						<span style="text-height: 15px"><big>&nbsp;거부 목록&nbsp;</big></span>
					</div>
				</div>
			</div>
		</div>
	</div>
 
	
	<!-- [지훈] 친구 관리 화면 End -->

	<!-- script plug in start -->
	
	<script type="text/javascript" src="cordova.js"></script>
	<!-- ip 등 meta data 가져오기 -->
	<script src="js/jihoon/getMetaData.js"></script>
	<script src="js/vendor/jquery-1.11.3.min.js"></script>
	<script src="js/vendor/jquery.ui.widget.js"></script>
	<script src="js/vendor/modernizr-2.8.3.min.js"></script>
	<script src="js/bootstrap/bootstrap.min.js"></script>


	<!--  아래는 스크립트 라이브러리 추가 및 스크립트 작성 영역입니다.-->
	<!-- [작성자] 추가 라이브러리 요약 -->
	<!-- 라이브러리 추가는 아래 형식으로 하시오 -->
	<script src="js/handlebars-v4.0.5.js"></script>
	<!-- 스크립트 작성 부분입니다 -->
	<script>
		//이 곳을 벗어나 스크립트를 작성하지마시오.

		// 전역변수 선언
		var fr_req_link = document
				.querySelector('link[href="import/friendReqList.html"]');
		var fr_link = document
				.querySelector('link[href="import/friendList.html"]');

		var user = getMetaData("user");
		var requestIP = getMetaData('ip');

		//친구요청, 목록 count 동적 이벤트 처리를 위한 변수
		var frReqCount;
		var frCount;

		$.ajax(requestIP+"friend/json/getFriendList", {
			method : "post",
			crossDomain : true,
			dataType : "json",
			contentType : "application/json; charset=UTF-8",
			data : JSON.stringify({
				uNo : user.uNo
			}),
			success : function(result) {

				frReqCount = result.frReqCount;
				frCount = result.frCount;

				$("#req_count").text(frReqCount);
				$("#fr_count").text(frCount);

				var frReqTemp = fr_req_link.import;
				var frTemp = fr_link.import;	

				/*친구 요청목록 Handlebars 사용부분 */
				var reqSource = frReqTemp.querySelector('#friendReqList_template').text;
				var reqTemplate = Handlebars.compile(reqSource);
				var reqHtml = reqTemplate(result);
				$('#friend_req_list').append(reqHtml);

				/*친구 목록 Handlebars 사용부분 */
				var frSource = frTemp.querySelector('#friend_template').text;
				var reqTemplate = Handlebars.compile(frSource);
				var frHtml = reqTemplate(result);
				$('#friend_list').append(frHtml);
			}
		});

		//[지훈] 친구 검색 동적 이벤트 처리
		$(document).on("click", "#searchFriend", function(){
			$('frame[name="innerframe"]').attr('scrolling', 'auto');
			$(window.parent.frames["innerframe"].document.location)
				.attr("href", "searchFriend.html");
		});

		//[지훈] 수신거부 목록 동적 이벤트 처리
		$(document).on("click", "#denyList", function(){
			$('frame[name="innerframe"]').attr('scrolling', 'auto');
			$(window.parent.frames["innerframe"].document.location)
				.attr("href", "denyFriend.html");
		});

		//[지훈]친구 일기보기 동적 이벤트 처리
		$(document).on("click", ".friendDiary", function(){

			var diaryUser = $(this).parent().children('#frNo').val();			
			window.localStorage.setItem("frDiaryKey", diaryUser);
	

			$('frame[name="innerframe"]').attr('scrolling', 'auto');
			$(window.parent.frames["innerframe"].document.location)
				.attr("href", "friendDiary.html");

				
			
		});


		//[지훈]친구요청 수락 동적 이벤트 처리
		$(document).on("click", ".aproveFriend", function(){
			var frNo = $(this).parent().children('#frNo').val();			
			var target = $(this).parent().parent();


			$.ajax(requestIP+"friend/json/approveFriend", {
				method : "post",
				crossDomain : true,
				dataType : "json",
				contentType : "application/json; charset=UTF-8",
				data : JSON.stringify({
					frNo : frNo
				}),
				success: function(result){
					frReqCount = frReqCount-1;
					frCount = frCount+1;
					$("#req_count").text(frReqCount);
					$("#fr_count").text(frCount);
					
					//수락한 항목 화면에서 제거
					target.remove();

					var frTemp = fr_link.import;

					var frSource = frTemp.querySelector('#friend_template').text;
					var reqTemplate = Handlebars.compile(frSource);
					var frHtml = reqTemplate(result);
					$('#friend_list').append(frHtml);
				}
			});
		});


		//[지훈]친구요청 거부 동적 이벤트 처리
		$(document).on("click", ".reqDeny", function(){
			var frNo = $(this).parent().children('#frNo').val();			
			var target = $(this).parent().parent();
			$.ajax(requestIP+"friend/json/deleteFriend", {
				method : "post",
				crossDomain : true,
				dataType : "json",
				contentType : "application/json; charset=UTF-8",
				data : JSON.stringify({
					frNo : frNo
				}),
				success: function(result){
					frReqCount = frReqCount-1;
					
					$("#req_count").text(frReqCount);
				
					//항목 화면에서 제거
					target.remove();
				}
			});
		});


		//[지훈]친구 차단 동적 이벤트 처리
		$(document).on("click", ".denyFriend", function(){

			var frNo = $(this).parent().children('#frNo').val();			
			var target = $(this).parent().parent();

			$.ajax(requestIP+"friend/json/denyFriend", {
				method : "post",
				crossDomain : true,
				dataType : "json",
				contentType : "application/json; charset=UTF-8",
				data : JSON.stringify({
					frNo : frNo
				}),
				success: function(result){
					frCount = frCount-1;
					
					$("#fr_count").text(frCount);
				
					//항목 화면에서 제거
					target.remove();
				}
			});
		});




	</script>
	<!-- 스크립트 작성 부분 끝입니다. -->

	<script>
		document.addEventListener("backbutton", onBackKeyDown, false);
		function onBackKeyDown() {
			//window.plugins.toast.show('Really Exit?'.'short'.'center',)
			testLogoutSheet();
		}
		//Action sheet
		function testLogoutSheet() {
			var options = {
				'androidTheme' : window.plugins.actionsheet.ANDROID_THEMES.THEME_HOLO_LIGHT,
				'title' : 'Are you sure to close it?',
				'buttonLabels' : [ 'No', 'Yes' ],
				'androidEnableCancelButton' : true,
				'winphoneEnableCancelButton' : true,
			//'addCancelButtonWithLabel': 'Cancel'
			};
			window.plugins.actionsheet.show(options, callback);
		}

		var callback = function(buttonIndex) {
			setTimeout(function() {
				//alert('button index clicked: ' + buttonIndex);
				if (buttonIndex == 2) {
					navigator.app.exitApp();
				}
				;
			});
		};
	</script>
</body>
</html>